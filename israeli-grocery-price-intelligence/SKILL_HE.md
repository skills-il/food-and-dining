# מודיעין מחירי מכולת ישראלי

## הוראות

### שלב 1: גישה לפידי XML של סופרמרקטים
בהתאם לחוק שקיפות מחירים (2015), רשתות סופרמרקט ישראליות עם 3 סניפים ומעלה חייבות לפרסם מחירי מוצרים כקבצי XML.
- הנתונים מפורסמים ב: prices.shufersal.co.il, ופורטלים דומים לכל רשת
- קבצי נתונים זמינים:
  - **PricesFull** — קטלוג מוצרים מלא עם מחירים
  - **PricesPromotions** — מבצעים והנחות פעילים
  - **Stores** — מיקומי סניפים ופרטיהם
- הקבצים מתעדכנים יומית (בדרך כלל בשעות הלילה)
- ראו `references/chain-feeds.md` לכתובות URL ושיטות גישה לכל רשת

### שלב 2: ניתוח פורמטי נתונים ספציפיים לרשת
כל רשת מפרסמת בסכמת XML מעט שונה. רשתות נתמכות:

| רשת | כתובת פיד | הערות |
|------|-----------|-------|
| שופרסל | prices.shufersal.co.il | הרשת הגדולה, הנתונים הכי מובנים |
| רמי לוי | בהתאם לרשת | ידועה במחירים נמוכים |
| יוחננוף | בהתאם לרשת | מרכז הארץ |
| ויקטורי | בהתאם לרשת | מוזגה עם מגה |
| אושר עד | בהתאם לרשת | רשת דיסקאונט |
| מגה | בהתאם לרשת | חלק מקבוצת אלון |
| טיב טעם | בהתאם לרשת | מוצרים לא כשרים זמינים |

השתמשו ב-`scripts/parse_price_xml.py` לניתוח פידים לפורמט JSON מנורמל.
שדות מפתח: קוד פריט, שם פריט, יצרן, מחיר, מחיר ליחידה, כמות, יחידת מידה, תאריך עדכון

### שלב 3: השוואת מחירים חוצת-רשתות
התאמת מוצרים בין רשתות לפי:
- **ברקוד** (הכי אמין — ברקוד ישראלי סטנדרטי)
- **שם פריט + יצרן** (התאמה מטושטשת להבדלי שמות)
- **קוד פריט** (ספציפי לרשת, פחות אמין להשוואה חוצת-רשתות)

יצירת טבלת השוואה למוצרים ספציפיים:
- חישוב: הרשת הזולה ביותר, מחיר ממוצע, פער מחירים (מקסימום-מינימום)
- טיפול בתמחור ספציפי לסניף (לאותה רשת עשויים להיות מחירים שונים לפי מיקום)

### שלב 4: אופטימיזציה של רשימות קניות
בהינתן רשימת קניות, מציאת האפשרות הזולה ביותר:
- **חנות אחת:** החנות הזולה ביותר לכל הסל
- **ריבוי חנויות:** חלוקה אופטימלית בין 2-3 חנויות קרובות (מינימום עלות + נסיעה)

שקלול מבצעים פעילים (פיד PricesPromotions). טיפול בתחליפים: הצעת חלופות זולות יותר למוצרים דומים.

חישוב עלות סל כוללת לכל תרחיש. התחשבות בהעדפות המשתמש: דרישות כשרות, אפשרויות אורגניות, העדפות מותג.

### שלב 5: מעקב אחרי מגמות מחירים
מעקב אחרי מחירים לאורך זמן עבור מוצרים במעקב:
- התראה על שינויים משמעותיים (עלייה או ירידה של מעל 10%)
- דוח מגמות מחירים שבועי לקטגוריות במעקב
- מעקב אחרי דפוסי אינפלציה לפי קטגוריית מזון
- השוואה מול נתוני מדד המחירים לצרכן — רכיב מזון

### שלב 6: ניתוח עלות מרכיבים למסעדות/קייטרינג
לבעלי מסעדות: חישוב עלויות מרכיבים מנתוני סופרמרקט.
- קלט: מתכון עם מרכיבים וכמויות
- פלט: עלות למנה על בסיס המחירים הזולים ביותר הזמינים
- מעקב אחרי מגמות עלות מרכיבים לאורך זמן
- התראה כאשר מחירי מרכיבים מרכזיים עולים בחדות
- הפקת דוח עלויות חודשי להחלטות תמחור תפריט

## דוגמאות

### דוגמה 1: השוואת מחירי חלב בין רשתות
המשתמש אומר: "איפה הכי זול לקנות חלב תנובה 3% ליטר?"
פעולות:
1. שאילתת פידי PricesFull מכל הרשתות עבור המוצר (התאמה לפי ברקוד)
2. ריכוז מחירים לפי רשת ומיקום סניף
3. החלת מבצעים פעילים מפיד PricesPromotions
4. יצירת טבלת השוואה ממוינת לפי מחיר
תוצאה: הזול ביותר: רמי לוי ב-5.90 ש"ח, אושר עד ב-6.10 ש"ח, שופרסל ב-6.50 ש"ח (אבל יש מבצע 2 ב-10). עם מבצע שופרסל, קנייה של 2 = 5.00 ש"ח ליחידה. המלצה: שופרסל אם קונים 2+, רמי לוי ליחידה בודדת.

### דוגמה 2: אופטימיזציה של רשימת קניות שבועית
המשתמש אומר: "הנה רשימת הקניות שלי לשבוע, מצאו לי את האפשרות הזולה ביותר באזור רמת גן"
פעולות:
1. ניתוח רשימת קניות (15 פריטים)
2. חיפוש מחירים ברשתות עם סניפים ליד רמת גן
3. חישוב: חנות אחת (רמי לוי: 285 ש"ח, שופרסל: 310 ש"ח, יוחננוף: 295 ש"ח)
4. חישוב: חלוקה אופטימלית ל-2 חנויות (רמי לוי + שופרסל עם מבצעים: 262 ש"ח)
5. הצעת 3 תחליפים לחיסכון נוסף של 18 ש"ח
תוצאה: חנות אחת הכי זולה: רמי לוי ב-285 ש"ח. חלוקה אופטימלית: רמי לוי (10 פריטים, 195 ש"ח) + שופרסל (5 פריטים עם מבצעים, 67 ש"ח) = 262 ש"ח. חיסכון כולל מול חנות אחת: 23 ש"ח.

### דוגמה 3: מעקב אחרי עלויות מרכיבים לתפריט מסעדה
המשתמש אומר: "תעקוב אחרי עלות המרכיבים של מנת השקשוקה שלי — עגבניות, ביצים, בצל, פלפלים, תבלינים"
פעולות:
1. זיהוי מוצרים תואמים בפידי המחירים (עגבניות טריות, ביצים מידה L, בצל צהוב, פלפל גמבה, כמון, פפריקה)
2. מציאת המחיר הזול ביותר לכל מרכיב בין הרשתות
3. חישוב עלות למנה (2 ביצים, 3 עגבניות, 1 בצל, 1 פלפל, תבלינים)
4. הגדרת מעקב מחירים שבועי למרכיבים אלו
5. הפקת דוח עלות בסיסי
תוצאה: עלות נוכחית למנה: 8.40 ש"ח (שילוב הרשתות הזולות ביותר). ביצים מהוות 32% מהעלות. התראת מחיר הוגדרה — תקבלו הודעה אם מחיר של מרכיב כלשהו משתנה ביותר מ-10%.

## משאבים מצורפים

### סקריפטים
- `scripts/parse_price_xml.py` — מנתח פידי XML של מחירי סופרמרקטים ישראליים ל-JSON מנורמל. תומך בפורמטים של שופרסל, רמי לוי ורשתות נוספות. מטפל בקבצי XML דחוסים ובקידוד תווים. הרצה: `python scripts/parse_price_xml.py --help`

### חומרי עזר
- `references/chain-feeds.md` — כתובות URL ושיטות גישה לפידי שקיפות מחירים של כל רשת סופרמרקטים ישראלית. כולל תיעוד סכמת XML, לוחות זמני עדכון ווריאציות פורמט ידועות. היעזרו בקובץ זה בעת גישה לנתוני רשתות בשלבים 1-2.

## פתרון בעיות

### שגיאה: "XML feed download failed"
סיבה: שרת שקיפות המחירים של הרשת מושבת זמנית או שכתובת ה-URL השתנתה.
פתרון: בדקו אם הרשת עדכנה את כתובת הפיד שלה (זה קורה מדי פעם). נסו לגשת לפיד ידנית בדפדפן. הפידים הכי אמינים בשעות הבוקר (מתעדכנים בלילה). ראו `references/chain-feeds.md` לכתובות עדכניות.

### שגיאה: "Product not found in cross-chain comparison"
סיבה: שם המוצר או הברקוד שונים בין רשתות.
פתרון: נסו התאמה לפי ברקוד קודם (הכי אמין). אם התאמת ברקוד נכשלת, השתמשו בהתאמת שם מטושטשת עם יצרן. חלק מהרשתות משתמשות בשמות מוצר שונים לאותו פריט (למשל, "חלב תנובה 3%" מול "חלב 3% תנובה").

### שגיאה: "Price data outdated"
סיבה: שימוש בנתונים שמורים מיום קודם או שהרשת עדיין לא עדכנה.
פתרון: בדקו את שדה UpdateDate בפיד ה-XML. רוב הרשתות מעדכנות בלילה. אם הנתונים ישנים יותר מ-24 שעות, אלצו הורדה מחדש. עדכוני פיד מבצעים עשויים לפגר אחרי עדכוני PricesFull.

### שגיאה: "Shopping list optimization slow"
סיבה: השוואת כל הפריטים בכל הרשתות ובכל הסניפים יקרה חישובית.
פתרון: הגבילו השוואה לרשתות עם סניפים ברדיוס ניתן להגדרה (ברירת מחדל: 5 ק"מ). סננו מראש לפי רשתות שהמשתמש בפועל קונה בהן. השתמשו בנתוני מחירים שמורים במקום להוריד מחדש לכל אופטימיזציה.
